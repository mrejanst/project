<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="z_project.portal_account_detail">
        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
        <div t-if="error_message" class="alert alert-danger" role="alert">
            <div class="col-lg-12">
                <t t-foreach="error_message" t-as="err"><t t-esc="err"/><br /></t>
            </div>
        </div>
        <div t-if="not partner_can_edit_vat" class="col-12 d-none d-xl-block">
            <small class="form-text text-muted">
                Company name, VAT Number and country can not be changed once document(s) have been issued for your account.
                <br/>Please contact us directly for that operation.
            </small>
        </div>
        <div t-attf-class="mb-3 #{error.get('name') and 'o_has_error' or ''} col-xl-6">
            <label class="col-form-label" for="name">Name</label>
            <input type="text" name="name" t-attf-class="form-control #{error.get('name') and 'is-invalid' or ''}" t-att-value="name or partner.name" />
        </div>
        <div t-attf-class="mb-3 #{error.get('email') and 'o_has_error' or ''} col-xl-6">
            <label class="col-form-label" for="email">Email</label>
            <input type="email" name="email" t-attf-class="form-control #{error.get('email') and 'is-invalid' or ''}" t-att-value="email or partner.email" />
        </div>

        <div class="clearfix" />
        <div t-attf-class="mb-1 #{error.get('company_name') and 'o_has_error' or ''} col-xl-6">
            <label class="col-form-label label-optional" for="company_name">Company Name</label>
            <!-- The <input> use "disabled" attribute to avoid sending an unauthorized value on form submit.
                 The user might not have rights to change company_name but should still be able to see it.
            -->
            <input type="text" name="company_name" t-attf-class="form-control #{error.get('company_name') and 'is-invalid' or ''}" t-att-value="company_name or partner.commercial_company_name" t-att-disabled="None if partner_can_edit_vat else '1'" />
            <small t-if="not partner_can_edit_vat" class="form-text text-muted d-block d-xl-none">
                Changing company name is not allowed once document(s) have been issued for your account. Please contact us directly for this operation.
            </small>
        </div>
        <div t-attf-class="mb-1 #{error.get('vat') and 'o_has_error' or ''} col-xl-6">
            <label class="col-form-label label-optional" for="vat">VAT Number</label>
            <!-- The <input> use "disabled" attribute to avoid sending an unauthorized value on form submit.
                 The user might not have rights to change company_name but should still be able to see it.
            -->
            <input type="text" name="vat" t-attf-class="form-control #{error.get('vat') and 'is-invalid' or ''}" t-att-value="vat or partner.vat" t-att-disabled="None if partner_can_edit_vat else '1'" />
            <small t-if="not partner_can_edit_vat" class="form-text text-muted d-block d-xl-none">Changing VAT number is not allowed once document(s) have been issued for your account. Please contact us directly for this operation.</small>
        </div>
        <div t-attf-class="mb-3 #{error.get('phone') and 'o_has_error' or ''} col-xl-6">
            <label class="col-form-label" for="phone">Phone</label>
            <input type="tel" name="phone" t-attf-class="form-control #{error.get('phone') and 'is-invalid' or ''}" t-att-value="phone or partner.phone" />
        </div>

        <div class="clearfix" />
        <div t-attf-class="mb-3 #{error.get('street') and 'o_has_error' or ''} col-xl-6">
            <label class="col-form-label" for="street">Street</label>
            <input type="text" name="street" t-attf-class="form-control #{error.get('street') and 'is-invalid' or ''}" t-att-value="street or partner.street"/>
        </div>
        <div t-attf-class="mb-3 #{error.get('city') and 'o_has_error' or ''} col-xl-6">
            <label class="col-form-label" for="city">City</label>
            <input type="text" name="city" t-attf-class="form-control #{error.get('city') and 'is-invalid' or ''}" t-att-value="city or partner.city" />
        </div>
        <div t-attf-class="mb-3 #{error.get('street2') and 'o_has_error' or ''} col-xl-6">
            <label class="col-form-label" for="street2">Street 2</label>
            <input type="text" name="street2" t-attf-class="form-control #{error.get('street2') and 'is-invalid' or ''}" t-att-value="street2 or partner.street2"/>
        </div>
        <div t-attf-class="mb-3 #{error.get('state_id') and 'o_has_error' or ''} col-xl-6">
            <label class="col-form-label label-optional" for="state_id">State / Province</label>
            <select name="state_id" t-attf-class="form-select #{error.get('state_id') and 'is-invalid' or ''}">
                <option value="">select...</option>
                <t t-foreach="states or []" t-as="state">
                    <option t-att-value="state.id" class="d-none" t-att-data-country_id="state.country_id.id" t-att-selected="state.id == int(state_id) if state_id else state.id == partner.state_id.id">
                        <t t-esc="state.name" />
                    </option>
                </t>
            </select>
        </div>
        <div t-attf-class="mb-3 #{error.get('zip') and 'o_has_error' or ''} col-xl-6">
            <label class="col-form-label label-optional" for="zipcode">Zip / Postal Code</label>
            <input type="text" name="zipcode" t-attf-class="form-control #{error.get('zip') and 'is-invalid' or ''}" t-att-value="zipcode or partner.zip" />
        </div>
        <div t-attf-class="mb-3 #{error.get('country_id') and 'o_has_error' or ''} col-xl-6">
            <label class="col-form-label" for="country_id">Country</label>
            <select name="country_id" t-attf-class="form-select #{error.get('country_id') and 'is-invalid' or ''}" t-att-disabled="None if partner_can_edit_vat else '1'">
                <option value="">Country...</option>
                <t t-foreach="countries or []" t-as="country">
                    <option t-att-value="country.id" t-att-selected="country.id == int(country_id) if country_id else country.id == partner.country_id.id">
                        <t t-esc="country.name" />
                    </option>
                </t>
            </select>
            <small t-if="not partner_can_edit_vat" class="form-text text-muted d-block d-xl-none">Changing the country is not allowed once document(s) have been issued for your account. Please contact us directly for this operation.</small>
        </div>
    </template>

    <template id="z_project.portal_account">
        <t t-call="z_project.portal_layout">
            <t t-set="additional_title">Contact Details</t>
            <form action="/portal/account" method="post">
                <div class="row o_portal_details">
                    <div class="col-lg-12">
                        <div class="row">
                            <t t-call="z_project.portal_account_detail"/>
                            <input type="hidden" name="redirect" t-att-value="redirect"/>
                        </div>
                        <div class="clearfix text-end mb-5">
                            <a href="/portal/" class="btn btn-light me-2">
                                Discard
                            </a>
                            <button type="submit" class="btn btn-primary float-end">
                                Save
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </t>
    </template>

    <template id="z_project.side_content">
        <div t-if="isOffcanvas" class="offcanvas-header justify-content-end">
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"/>
        </div>
        <div t-attf-class="{{'offcanvas-body' if isOffcanvas else 'mt-3 mw-100'}}">
            <div class="d-flex justify-content-start align-items-start gap-3 mb-4">
                <img class="o_portal_contact_img rounded o_object_fit_cover" t-att-src="image_data_uri(user_id.partner_id.avatar_128)" alt="Contact" width="50"/>
                <div class="d-flex flex-column justify-content-center">
                    <h5 class="mb-0" t-out="user_id.name"/>
                    <p class="mb-0 text-muted" t-out="user_id.company_name"/>
                </div>
            </div>
            <div class="o_portal_my_details">
                <div t-field="user_id.partner_id" t-options='{"widget": "contact", "fields": ["email", "phone", "address"]}'/>
            </div>
            <a role="button" href="/portal/account" class="btn btn-link p-0 mt-3"><i class="fa fa-pencil"/> Edit information</a>
            <div name="portal_contact" class="o_my_contact mt-5" t-if="sales_user">
                <t t-call="z_project.portal_contact"/>
            </div>
        </div>
    </template>

    <template id="z_project.portal_contact" name="Contact">
        <div class="o_portal_contact_details mb-5">
            <h5>Your contact</h5>
            <hr class="mt-1"/>
            <h6 t-esc="sales_user.name"/>
            <div class="d-flex align-items-baseline mb-1">
                <i class="fa fa-envelope fa-fw me-1 text-600"/>
                <a class="text-break w-100" t-att-href="'mailto:'+sales_user.email" t-esc="sales_user.email"/>
            </div>
            <div class="d-flex flex-nowrap align-items-center mb-1">
                <i class="fa fa-phone fa-fw me-1 text-600"/>
                <span t-esc="sales_user.phone"/>
            </div>
            <div class="d-flex flex-nowrap align-items-center mb-1">
                <i class="fa fa-map-marker fa-fw me-1 text-600"/>
                <span t-esc="sales_user.city"/>
            </div>
        </div>
    </template>

    <template id="z_project.portal_breadcrumbs_mtm" name="Portal Breadcrumbs">
        <ol t-if="page_name != 'home'" class="o_portal_submenu breadcrumb mb-0 flex-grow-1 px-0">
            <li class="breadcrumb-item ms-1"><a href="/portal" aria-label="Home" title="Home"><i class="fa fa-home"/></a></li>
            <li t-if="page_name == 'my_details'" class="breadcrumb-item">Details</li>
            <li t-if="page_name == 'Projects'" class="breadcrumb-item">Projects</li>
        </ol>
    </template>

    <template id="z_project.portal_layout" name="Portal Layout">
        <t t-call="portal.frontend_layout">

            <t t-set="is_portal" t-value="True"/>
            <div t-if="not no_breadcrumbs and not my_details and not breadcrumbs_searchbar" class="o_portal container mt-3">
                <div class="d-flex justify-content-between align-items-center flex-wrap">
                    <t t-call="z_project.portal_breadcrumbs_mtm"/>
                    <t t-if="prev_record or next_record" t-call='portal.record_pager'/>
                </div>
            </div>
            <div id="wrap" class='o_portal_wrap'>
                <div class="container pt-3 pb-5">
                    <t t-if="my_details">
                        <div class="wrapper col-12 d-flex flex-wrap justify-content-between align-items-center">
                            <h3 class="my-3">My account</h3>
                            <button class="btn py-0 d-flex align-items-center gap-2 d-lg-none ms-auto"
                            data-bs-toggle="offcanvas"
                            data-bs-target="#accountOffCanvas">
                                <img class="o_avatar rounded"
                                t-att-src="image_data_uri(user_id.partner_id.avatar_1024)" alt="Contact"/>
                            </button>
                        </div>
                        <div class="row justify-content-between">
                            <div t-attf-class="o_portal_content col-12 col-lg-8 mb-5">
                                <t t-out="0"/>
                            </div>
                            <div class="d-none d-lg-flex justify-content-end col-lg-4">
                                <t t-call="z_project.side_content"/>
                            </div>
                            <div class="offcanvas offcanvas-start d-lg-none" id="accountOffCanvas">
                                <t t-call="z_project.side_content">
                                    <t t-set="isOffcanvas" t-value="true"/>
                                </t>
                            </div>
                        </div>
                    </t>
                    <t t-else="">
                        <t t-out="0"/>
                    </t>
                </div>
            </div>
        </t>
    </template>

</odoo>